# CryptoCore - Отчет о статусе Спринта 4

Спринт: 4  
Статус:  Завершен  
Тема: Добавление криптографических хеш-функций и команды dgst

## Цель Спринта 4
Добавить вычисление криптографических хешей файлов (минимум SHA-256 и еще один алгоритм) с отдельно выделенной командой `dgst`, сохранить совместимость и неизменность существующей функциональности.

---

## Контрольный список соответствия требованиям

### 1. Структура проекта и гигиена репозитория

| ID | Требование | Статус | Примечания |
|----|------------|--------|------------|
| STR-1 | Все требования предыдущих спринтов (STR-1…STR-4) выполнены |  Выполнено | Шифрование/дешифрование, потоковая обработка, CLI – без регрессий |
| STR-2 | Создать структуру `src/hash/` с реализациями |  Выполнено | Добавлены `src/hash/sha256.c`, `src/hash/sha3.c`, `include/hash.h` |
| STR-3 | Обновить README: dgst, примеры, свойства алгоритмов |  Выполнено | Раздел “Хеширование (dgst)”, примеры, примечания по безопасности |
| STR-4 | Обновить систему сборки |  Выполнено | Makefile и build.bat компилируют и линкуют новые файлы |

### 2. Интерфейс командной строки (CLI)

| ID | Требование | Статус | Реализация |
|----|------------|--------|------------|
| CLI-1 | Поддержать подкоманду `dgst` |  Выполнено | Парсинг и маршрутизация в `main.c` |
| CLI-2 | Аргументы: `--algorithm`, `--input` |  Выполнено | `sha256`, `sha3-256`; путь к файлу |
| CLI-3 | Независимость от аргументов шифрования |  Выполнено | `--key/--mode/--iv` не требуются и не используются |
| CLI-4 | Формат вывода: `HEX FILEPATH` |  Выполнено | Совместимо с утилитами `*sum` |
| CLI-5 | Необязательный `--output` |  Выполнено | Пишет ту же строку, что и stdout |

### 3. Реализация хеш-функций

| ID | Требование | Статус | Реализация |
|----|------------|--------|------------|
| HASH-1 | SHA-256 «с нуля» (FIPS 180-4) |  Выполнено | `src/hash/sha256.c`: padding, расписание W, 64 раунда, константы, финализация |
| HASH-2/3 | Второй алгоритм: SHA3-256 (EVP) |  Выполнено | `src/hash/sha3.c`: OpenSSL EVP_sha3_256, потоковая обработка |
| HASH-5 | Потоковая обработка (constant memory) | Выполнено | Буфер 4096 байт, чтение чанками |
| HASH-6 | Низкий регистр в hex | Выполнено | `hash_to_hex` выводит lowercase |

### 4. Ввод/вывод для хеширования

| ID | Требование | Статус | Реализация |
|----|------------|--------|------------|
| IO-1 | Открытие в бинарном режиме |  Выполнено | `rb` |
| IO-2 | Обработка файлов любого размера | Выполнено | Чтение чанками, без загрузки целиком |
| IO-3 | `--output` записывает строку как в stdout |  Выполнено | В `main.c` |
| IO-4 | Понятные сообщения об ошибках |  Выполнено | Ошибки в `stderr`, корректный код возврата |

### 5. Тестирование и проверка

| ID | Требование | Статус | Примечания |
|----|------------|--------|------------|
| TEST-1 | Известные ответы (empty input) | Выполнено | SHA-256 от пустого: `e3b0…b855` |
| TEST-2 | Интероперабельность с системными утилитами |  Выполнено | Совпадает с `sha256sum` на `png-1.svg` |
| TEST-3 | Большие файлы |  Выполнено | Потоковый дизайн проверен на больших файлах |
| TEST-4 | Тест лавинного эффекта (пример) |  Документация | Рекомендации по реализации теста из `sprint4.txt` |

---

## Изменения в коде

### Новые файлы
1. `src/hash/sha256.c` — реализация SHA-256 с нуля (FIPS 180-4)
2. `src/hash/sha3.c` — реализация SHA3-256 через OpenSSL EVP
3. `include/hash.h` — объявления хеш-функций и утилит

### Обновленные файлы
1. `main.c` — добавлена подкоманда `dgst`, обработка `--algorithm/--input/--output`, корректные коды возврата при ошибках
2. `README.md` — раздел “Хеширование (dgst)”: синтаксис, примеры, свойства алгоритмов, примечания для Windows/MSYS2
3. `Makefile`, `build.bat` — сборка новых исходников и линковка

---

## Примеры использования

```bash
# Базовое хеширование SHA-256
./cryptocore dgst --algorithm sha256 --input ./files/png-1.svg

# Хеширование SHA3-256 с записью результата в файл
./cryptocore dgst --algorithm sha3-256 --input backup.tar --output backup.sha3

# Пустой файл (ожидаемый SHA-256)
./cryptocore dgst --algorithm sha256 --input empty.txt
# e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855  empty.txt
```

Примечание (Windows/MSYS2): возможны проблемы с открытием файлов с кириллицей в имени. Рекомендуется использовать ASCII-имена или пути без не-ASCII символов.

---

## Сводка соответствия
- Реализованы SHA-256 (с нуля) и SHA3-256 (через OpenSSL)
- Подкоманда `dgst` с требуемыми аргументами и форматом вывода
- Потоковая обработка и большие файлы
- Документация и сборка обновлены
- Корректная обработка ошибок (без вывода «нулевого» хеша при ошибке)

---

## Примечания по безопасности
- SHA-256 и SHA3-256 обеспечивают стойкость к коллизиям на практике; SHA3-256 основан на конструкции губки Keccak.
- Вывод хеша предназначен для проверки целостности